import { loadDb, saveDb } from "./db";\nimport { createId } from "../../../utils/id";\n\nfunction sanitizeUser(user) {\n  const { password, ...safe } = user;\n  return safe;\n}\n\nexport const auth = {\n  async login({ email, password }) {\n    const db = await loadDb();\n    const user = db.users.find((u) => u.email.toLowerCase() === String(email).toLowerCase());\n    if (!user || user.password !== password) {\n      throw new Error("Invalid email or password");\n    }\n    return sanitizeUser(user);\n  },\n\n  async register({\n    workspaceId,\n    role,\n    fullName,\n    email,\n    phone,\n    password,\n    firstName,\n    displayName,\n    professionalTitle,\n  }) {\n    const db = await loadDb();\n    const exists = db.users.some((u) => u.email.toLowerCase() === String(email).toLowerCase());\n    if (exists) throw new Error("Email already registered");\n\n    // Ensure BusinessCafé workspace exists for the hub product.\n    db.workspaces = Array.isArray(db.workspaces) ? db.workspaces : [];\n    if (!db.workspaces.some((w) => w.id === "ws_businesscafe")) {\n      db.workspaces.push({ id: "ws_businesscafe", name: "BusinessCafé" });\n    }\n\n    const user = {\n      id: createId("u"),\n      workspaceId,\n      role,\n      fullName,\n      firstName: firstName || "",\n      displayName: displayName || "",\n      professionalTitle: professionalTitle || "",\n      email,\n      phone: phone || "",\n      password,\n    };\n\n    db.users.unshift(user);\n\n    db.memberships = Array.isArray(db.memberships) ? db.memberships : [];\n    db.memberships.unshift({ userId: user.id, workspaceId: user.workspaceId });\n\n    await saveDb(db);\n    return sanitizeUser(user);\n  },\n\n  async forgotPassword({ email }) {\n    // Mock flow: always succeed (do not reveal whether email exists)\n    return { ok: true, message: `If an account exists for ${email}, you will receive an email shortly.` };\n  },\n};\n